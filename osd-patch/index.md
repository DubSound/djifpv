# Инструкция по получению Betaflight Warnings и Crossfire LQ в DJI OSD

Как мы все знаем, DJI почему-то не добавили очень важные элементы осд: варнинги и LQ. 
Что ж, придется сделать это самим.

### Как это работает

Вместо важных варнингов, DJI OSD поддерживает одно абсолютно бесполезное поле - craft name. 
Суть патча в том, что мы записываем нужную нам информацию в поле Craft Name и OSD послушно выводит на экран все то, что мы туда записали.
Так как поле у нас одно, а выводить хочется сразу два параметра, то я поступил так: если есть какие-то варнинги, то показываются варнинги. Если варнингов нет, то показывается LQ.
`Можно было бы сделать, чтобы выводилось сразу и то и другое в одно поле, но мне лень. Сам патч лежи в папке osd-patch, можете доделать, если есть желание :)`

### Только для Unified targets

`Мне лень разбираться, но скрипты блида в гитхабе не поддерживают сборку прошивки под конкретный полетник. 
Прошивка собирается под процессор, дальше сверху применяется конфиг из Unified targets. 
Если кто-то хочет собрать прошивки под все полетники - велком :) А пока инструкция для Unified targets:`


## Порядок действий:

**Все действия вы делаете на свой страх и риск. 
Бутлоадер на наших процах находится в защищенной памяти и его нельзя стереть, что означает, что вы не убьете ваш полетник неправильной прошивкой.
Но если у вас все же это получится, то я никакой ответственности за это не несу :)**

1. Переходим по [ссылке](https://github.com/betaflight/unified-targets/tree/master/configs/default) и ищем там свой таргет. 
Если таргета нет, то закрываем страничку и забываем о варнингах.

1. Сохраните этот файл, он понадобится нам на шаге №7 сразу после перепрошивки.

1. Первая строчка найденного конфига будет что-то типа:
   
    `# Betaflight / STM32F405 (S405) 4.1.0 Sep  8 2019 / 13:33:44 (ab4328f29) MSP API: 1.42`

    Здесь нас интересует модель процессора. В данном случае это **STM32F405**. 
    
1. Скачиваем соответствующий файл прошивки:
    * [STM32F405](/4.2.3_hex/betaflight_4.2.3_STM32F405_norevision.hex)
    * [STM32F411](/4.2.3_hex/betaflight_4.2.3_STM32F411_norevision.hex)
    * [STM32F722](/4.2.3_hex/betaflight_4.2.3_STM32F7X2_norevision.hex)
    * [STM32F7X2](/4.2.3_hex/betaflight_4.2.3_STM32F7X2_norevision.hex)
    * [STM32F745](/4.2.3_hex/betaflight_4.2.3_STM32F745_norevision.hex)

1. Сохраняем дамп текущих настроек вашей прошивки, как вы это делаете при обычной перепрошивке. Все ваши настройки слетят, поэтому позаботьтесь о дампе или будете настраивать все с нуля!

1. Переходим на вкладку прошивки, нажимаем "Load Firmware (Local)", выбираем скаченный HEX файл и прошиваем им полетник.

1. После прошивки у вас может не работать переферия, включая акселерометр, гироскоп и тд. Это нормально. 
Берем файл конфига, который мы сохранили в пункте №2 и применяем его. После перезагрузки полетника вся переферия должна заработать.

1. Применяем ваш собственный конфиг, сохраненный в пункте №5

1. Переходим в настройки OSD, включаем пункты Warnings, LQ и Craft Name. Последнее поле важно! Именно через него будет выводиться нужная нам информация. Разместите Craft Name там, где хотите видеть варнинги.

1. Сохраняем, проверяем :)
